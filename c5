# CELL 8: Simple Working Execution
try:
    # Initialize Spark
    spark = SparkSession.builder.getOrCreate()
    
    # Check if speech_config exists
    if 'speech_config' not in globals() or speech_config is None:
        print("ERROR: Speech config not found. Please run Cell 5 first.")
    else:
        # Your MP3 file path
        mp3_file_path = "/Workspace/Users/anuj.b.s@mughalvaren.com/sample-ppt/audio/presentation_script/1_user_say/mygov_1.mp3"
        
        # Check if file exists
        if os.path.exists(mp3_file_path):
            print(f"Processing: {mp3_file_path}")
            
            # Run the pipeline
            result = process_mp3_file(mp3_file_path)
            
            if result is not None:
                print("SUCCESS: Pipeline completed")
                display(result)
                result.write.mode("append").saveAsTable("audio_transcripts")
                print("MP3 transcript pipeline completed")
            else:
                print("ERROR: Pipeline returned None")
        else:
            print(f"ERROR: File not found: {mp3_file_path}")
            print("Please check your file path")
            
except Exception as e:
    print(f"ERROR in Cell 8: {str(e)}")
    print("Please check previous cells and try again")