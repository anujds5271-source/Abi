# ==========================================
# CELL 4: Simple DataFrame Functions
# ==========================================

def create_simple_dataframe(mp3_file_path, transcript):
    """Create simple DataFrame with only filename and transcript"""
    filename = os.path.basename(mp3_file_path)
    
    if not filename or filename == "":
        filename = "unknown_file.mp3"
    
    df = pd.DataFrame({
        'file_name': [filename],
        'transcript': [transcript if transcript else "TRANSCRIPTION_FAILED"]
    })
    
    return df

def display_simple_dataframe(df):
    """Display clean DataFrame with full transcript"""
    spark = SparkSession.builder.getOrCreate()
    spark_df = spark.createDataFrame(df)
    
    display(spark_df)
    
    return spark_df

def create_catalog_and_save(spark_df):
    """Create catalog and save simple table"""
    try:
        spark = SparkSession.builder.getOrCreate()
        
        spark.sql(f"USE CATALOG {CATALOG_NAME}")
        spark.sql(f"USE SCHEMA {SCHEMA_NAME}")
        
        full_table_name = f"{CATALOG_NAME}.{SCHEMA_NAME}.{TABLE_NAME}"
        
        spark_df.write \
            .mode("append") \
            .option("mergeSchema", "true") \
            .saveAsTable(full_table_name)
        
        return True
        
    except Exception as e:
        print(f"Error: {str(e)}")
        return False
